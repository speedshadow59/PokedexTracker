<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokédex Tracker - CIAM Auth</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>

<header class="header">
    <div class="container">
        <h1>Pokédex Tracker</h1>
        <div class="progress-container">
            <div class="progress-text">Caught: <strong id="progressCount">0/0</strong></div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>
        <div class="actions" style="margin-top: 10px; display: flex; gap: 8px; align-items: center;">
            <button id="exportBtn" class="save-btn" style="padding: 6px 12px;">Export Data</button>
            <label class="import-label" style="cursor: pointer;">
                <span class="back-btn" style="padding: 6px 12px; display: inline-block;">Import Data</span>
                <input type="file" id="importFile" accept="application/json" style="display:none;" />
            </label>
            <button id="shareBtn" class="save-btn" style="padding: 6px 12px;">Share Pokédex</button>
            <button id="adminDashboardBtn" class="save-btn" style="padding: 6px 12px; display:none;">Admin Dashboard</button>
            <span id="backendStatus" style="padding: 4px 8px; border-radius: 6px; font-size: 12px; background: #eee; color: #333;">Cloud Sync: Checking…</span>
            <span id="userInfo" class="user-badge" style="display:none;"><span class="status-dot"></span><span id="userNameLabel">Signed in</span></span>
            <a href="/.auth/login/aad" id="loginLink" class="auth-link login">Sign in</a>
            <a href="/.auth/logout" id="logoutLink" class="auth-link logout" style="display:none;">Sign out</a>
        </div>
    </div>
</header>


<main class="container">

    <!-- Admin Dashboard (hidden by default, shown for admins) -->
    <section id="adminDashboard" class="admin-dashboard" style="display:none; margin-bottom: 32px;">
        <h2>Admin Dashboard</h2>
        <div id="adminTabs" style="margin-bottom: 16px;">
            <button id="adminTabUsers" class="admin-tab-btn active">User Management</button>
            <button id="adminTabMedia" class="admin-tab-btn">Content Moderation</button>
            <button id="adminTabAudit" class="admin-tab-btn">Audit Log</button>
        </div>
        <div id="adminPanelUsers" class="admin-panel-section"></div>
        <div id="adminPanelMedia" class="admin-panel-section" style="display:none;"></div>
        <div id="adminPanelAudit" class="admin-panel-section" style="display:none;"></div>
    </section>

    <section id="authPanel" class="auth-panel">
        <div>
            <h2>Sign in to sync your Pokédex</h2>
            <p>Use your Azure account to enable cloud sync and backups.</p>
        </div>
        <div class="auth-actions">
            <a href="/.auth/login/aad" class="primary-btn">Login with Azure</a>
            <a href="/.auth/logout" class="secondary-btn">Logout</a>
        </div>
    </section>

    <section class="region-selector">
        <h2>Select a Region</h2>
        <div class="region-grid" id="regionGrid">
            <button class="region-btn" data-region="kanto" data-offset="0" data-limit="151">Kanto (Gen I)</button>
            <button class="region-btn" data-region="johto" data-offset="151" data-limit="100">Johto (Gen II)</button>
            <button class="region-btn" data-region="hoenn" data-offset="251" data-limit="135">Hoenn (Gen III)</button>
            <button class="region-btn" data-region="sinnoh" data-offset="386" data-limit="107">Sinnoh (Gen IV)</button>
            <button class="region-btn" data-region="unova" data-offset="493" data-limit="156">Unova (Gen V)</button>
            <button class="region-btn" data-region="kalos" data-offset="649" data-limit="72">Kalos (Gen VI)</button>
            <button class="region-btn" data-region="alola" data-offset="721" data-limit="88">Alola (Gen VII)</button>
            <button class="region-btn" data-region="galar" data-offset="809" data-limit="89">Galar (Gen VIII)</button>
        </div>
    </section>

    <section id="pokedexSection" class="pokedex-section" style="display: none;">
        <div class="section-header">
            <div style="display: flex; justify-content: space-between; align-items: center; gap: 20px;">
                <div>
                    <h2 id="regionTitle">Pokédex</h2>
                </div>
                <div class="search-controls">
                    <input type="text" id="searchInput" placeholder="Search Pokémon..." class="search-input" />
                    <button type="button" id="aiSearchToggle" class="pill-btn">AI Search: Off</button>
                    <span id="aiSearchStatus" class="status-pill">Local filter</span>
                </div>
                <button class="back-btn" id="backBtn">← Back to Regions</button>
            </div>
        </div>
        <div id="pokemonGrid" class="pokemon-grid"></div>
        <div id="loadingSpinner" class="loading-spinner" style="display: none;">
            <div class="spinner"></div>
            <p>Loading Pokémon...</p>
        </div>
    </section>

    <!-- Share Link Modal (at body root) -->
    <div id="shareModal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close-modal" id="closeShareModal">&times;</span>
            <div class="modal-body">
                <div>
                    <h3>Share Your Pokédex</h3>
                    <p>Copy and share this link to let others view your Pokédex:</p>
                </div>
                <div class="share-link-container">
                    <input type="text" id="shareLinkInput" readonly class="share-link-input" />
                    <button id="copyShareLinkBtn" class="save-btn copy-link-btn">Copy Link</button>
                    <button id="unshareBtn" class="uncatch-btn" type="button">Make Private</button>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Toast Notifications -->
<div id="toastContainer" class="toast-container"></div>

<script>
// Toast notification system
function showToast(message, type = 'success', duration = 3000) {
    const container = document.getElementById('toastContainer');
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    toast.textContent = message;
    container.appendChild(toast);
    
    // Trigger animation
    setTimeout(() => toast.classList.add('show'), 10);
    
    // Auto remove
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
    }, duration);
}
</script>

</main>

<!-- Pokemon Detail Modal -->
<div id="pokemonModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" id="closeModal">&times;</span>
        <div class="modal-body">
            <div class="modal-left">
                <img id="modalSprite" src="" alt="Pokemon sprite" class="modal-sprite">
                <h2 id="modalName" class="modal-name"></h2>
                <p id="modalNumber" class="modal-number"></p>
                <div class="modal-types" id="modalTypes"></div>
            </div>
            <div class="modal-right">
                <div id="modalAuthNotice" class="auth-notice" style="display:none;">Sign in to catch, edit notes, or upload media.</div>
                <div class="form-group">
                    <label for="shinyToggle" class="checkbox-label">
                        <input type="checkbox" id="shinyToggle">
                        <span>Shiny</span>
                    </label>
                </div>
                <div class="form-group">
                    <label for="catchNotes">Notes:</label>
                    <textarea id="catchNotes" placeholder="Add notes about how you caught this Pokémon..." rows="4"></textarea>
                </div>
                <div class="form-group">
                    <label for="screenshotUpload">Screenshot:</label>
                    <input type="file" id="screenshotUpload" accept="image/*">
                    <div id="screenshotPreview" class="screenshot-preview"></div>
                </div>
                <div class="modal-actions">
                    <button id="saveBtn" class="save-btn">Save</button>
                    <button id="uncatchBtn" class="uncatch-btn">Mark as Uncaught</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="js/config.js"></script>
<script src="js/script.js"></script>
</body>
</html>
